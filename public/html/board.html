<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Board</title>
    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/socket.io.slim.js"></script>
	<style>
	td {border: solid 1px #000000}
	#request {font-size:20px; background-color:#ccd0ce;    width: fit-content ;     cursor: -webkit-grab;}
  #orderbydate {font-size:20px; background-color:#ccd0ce;    width: fit-content ;     cursor: -webkit-grab;}
  #orderbypay {font-size:20px; background-color:#ccd0ce;    width: fit-content ;     cursor: -webkit-grab;}

  </style>
</head>
<body>
  <div> 현재 사용자</div>
  <input id="cur_log" type="text" readonly>
  <br>
  <br>
  <div> 진행중인 의뢰 </div>
  <div>
  	<!--
  	<div id = "request">의뢰 리스트 가져오기</div>
  	-->
  	<table id = "doing_request">
      <thead>
        <tr>
          <td>의뢰번호</td>
          <td>의뢰자ID</td>
          <td>급여</td>
          <td>시작날짜</td>
          <td>완료날짜</td>
          <td>최소경력조건</td>
          <td>최소참여</td>
          <td>최대참여</td>
          <td>의뢰자평점</td>
          <td>프리랜서평점</td>
          <td>의뢰상태</td>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
<br>
  <div> 지원한 의뢰 </div>
  <div>
  	<!--
  	<div id = "request">의뢰 리스트 가져오기</div>
  	-->
  	<table id = "apply_request">
      <thead>
        <tr>
          <td>의뢰번호</td>
          <td>의뢰자ID</td>
          <td>급여</td>
          <td>시작날짜</td>
          <td>완료날짜</td>
          <td>최소경력조건</td>
          <td>최소참여</td>
          <td>최대참여</td>
          <td>의뢰자평점</td>
          <td>프리랜서평점</td>
          <td>의뢰상태</td>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

<br>
<br>
<br>
<div id = "orderbydate"> 날짜순 정렬 </div>
<br>
<div id = "orderbypay"> 임금순 정렬 </div>

<br>
<div> 의뢰 목록 </div>
<div>
	<!--
	<div id = "request">의뢰 리스트 가져오기</div>
	-->
	<table id = "req_list">
    <thead>
      <tr>
        <td>의뢰번호</td>
        <td>의뢰자ID</td>
        <td>급여</td>
        <td>시작날짜</td>
        <td>완료날짜</td>
        <td>최소경력조건</td>
        <td>최소참여</td>
        <td>최대참여</td>
        <td>의뢰자평점</td>
        <td>프리랜서평점</td>
        <td>의뢰상태</td>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>

<br>

<form id="apply">
      <input id="applyRID" placeholder="지원할 의뢰번호 입력" type="text">
      <input id="clientId" placeholder="의뢰자ID 입력" type="text">
      <input type="submit" value="지원하기"/>
</form>

<script>
  $('#req_list tr').each(function(){
    console.log("gsdg");
        var tr = $(this);
        var td = tr.children();
        var text = td.eq(2).text();
        });
    $(function() {
      var socket = io();
      var get = 'a';
      //asd는 모르겟고... 그냥 통신 시작될때 작동하는 함수.
      socket.on('asd', function(msg) {
        $.ajax({
            type: 'get',
            url: '/request/cur_log',
            data: {data:get},
            //data: getid,
            success: function(data) {
          //$('#cur_log').html("")
          //$('#user_list tbody').empty();
          //$('#cur_log').html(result.result);
          $('#cur_log').val(data);

        },
            error: function(err) {
              console.log(err);
            }
        });

        $.ajax({
            type: 'get',
            url: '/request',
            //data: getid,
            success: function(data) {
          $('#req_list tbody').html("")
          //$('#user_list tbody').empty();
          for(var i = 0 ; i < data.length; i ++) {
             var will_be_append = $('<tr><td>'+data[i].RID+'</td><td>' + data[i].PID+'</td><td>' +
               data[i].Pay+'</td><td>' + data[i].StartDate+'</td><td>' +
                 data[i].EndDate+'</td><td>' + data[i].MinCareer+'</td><td>' +
                   data[i].MinNum+'</td><td>' + data[i].MaxNum+'</td><td>' +
                     data[i].CGrade+'</td><td>' + data[i].FGrade+'</td><td>' +
                       data[i].State+'</td></tr>' )

            $('#req_list tbody').append(will_be_append)
          }
        },
            error: function(err) {
              console.log(err);
            }
        });

        $.ajax({
            type: 'get',
            url: '/request/doing',
            success: function(data) {
          $('#doing_request tbody').html("")
          //$('#user_list tbody').empty();
          for(var i = 0 ; i < data.length; i ++) {
             var will_be_append = $('<tr><td>'+data[i].RID+'</td><td>' + data[i].PID+'</td><td>' +
               data[i].Pay+'</td><td>' + data[i].StartDate+'</td><td>' +
                 data[i].EndDate+'</td><td>' + data[i].MinCareer+'</td><td>' +
                   data[i].MinNum+'</td><td>' + data[i].MaxNum+'</td><td>' +
                     data[i].CGrade+'</td><td>' + data[i].FGrade+'</td><td>' +
                       data[i].State+'</td></tr>' )

            $('#doing_request tbody').append(will_be_append)
          }
        },
            error: function(err) {
              console.log(err);
            }
        });
        $.ajax({
            type: 'get',
            url: '/request/apply_request',
            success: function(data) {
          $('#apply_request tbody').html("")
          //$('#user_list tbody').empty();
          for(var i = 0 ; i < data.length; i ++) {
             var will_be_append = $('<tr><td>'+data[i].RID+'</td><td>' + data[i].PID+'</td><td>' +
               data[i].Pay+'</td><td>' + data[i].StartDate+'</td><td>' +
                 data[i].EndDate+'</td><td>' + data[i].MinCareer+'</td><td>' +
                   data[i].MinNum+'</td><td>' + data[i].MaxNum+'</td><td>' +
                     data[i].CGrade+'</td><td>' + data[i].FGrade+'</td><td>' +
                       data[i].State+'</td></tr>' )

            $('#apply_request tbody').append(will_be_append)
          }
        },
            error: function(err) {
              console.log(err);
            }
        });

      })

      $('#orderbydate').click('orderbydate', function(){
        $.ajax({
            type: 'get',
            url: '/request/orderbydate',
            success: function(data) {
          $('#req_list tbody').html("")
          //$('#user_list tbody').empty();
          for(var i = 0 ; i < data.length; i ++) {
             var will_be_append = $('<tr><td>'+data[i].RID+'</td><td>' + data[i].PID+'</td><td>' + data[i].Pay+'</td><td>' + data[i].StartDate+'</td><td>' + data[i].EndDate+'</td><td>' + data[i].MinCareer+'</td><td>' + data[i].MinNum+'</td><td>' + data[i].MaxNum+'</td><td>' + data[i].CGrade+'</td><td>' + data[i].FGrade+'</td><td>' + data[i].State+'</td></tr>' )
                 $('#req_list tbody').append(will_be_append)
          }
        },
            error: function(err) {
              console.log(err);
            }
        });

      })
      $('#orderbypay').click('orderbypay', function(){
        $.ajax({
            type: 'get',
            url: '/request/orderbypay',
            success: function(data) {
          $('#req_list tbody').html("")
          //$('#user_list tbody').empty();
          for(var i = 0 ; i < data.length; i ++) {
             var will_be_append = $('<tr><td>'+data[i].RID+'</td><td>' + data[i].PID+'</td><td>' + data[i].Pay+'</td><td>' + data[i].StartDate+'</td><td>' + data[i].EndDate+'</td><td>' + data[i].MinCareer+'</td><td>' + data[i].MinNum+'</td><td>' + data[i].MaxNum+'</td><td>' + data[i].CGrade+'</td><td>' + data[i].FGrade+'</td><td>' + data[i].State+'</td></tr>' )
                 $('#req_list tbody').append(will_be_append)
          }
        },
            error: function(err) {
              console.log(err);
            }
        });

      })
      $('#apply').on('submit', function(){
        var v = {
        id: $("#apply #applyRID").val(),
        cli_id: $("#apply #clientId").val(),
        }
        $.ajax({
            type: 'post',
            url: '/request/apply',
            //dataType: "json",
            data: v,
            success: function(data) {
              //alert("성공");

            },
            error: function(err) {
              //alert(err.status);
              console.log(err);
            }
        });

      })
    });
</script>
</body>
</html>
